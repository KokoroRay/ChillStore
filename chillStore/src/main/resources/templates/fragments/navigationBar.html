<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<head>
    <meta charset="UTF-8">
    <title>Navigation Bar</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/navigationBar.css}">
    <link rel="stylesheet" th:href="@{/css/autocomplete.css}">
</head>
<body>
<div th:fragment="navBar">
    <nav class="horizontal-sidebar">
        <div class="nav-left">
            <ul>
                <li><a href="/">Introduct</a></li>
                <li><a th:href="@{/Product}">Product</a></li>
                <li><a th:href="@{/DiscountProducts}">Discount</a></li>
                <li sec:authorize="hasRole('CUSTOMER')">
                    <a th:href="@{/customer/order}">Order</a>
                </li>
                <li sec:authorize="hasRole('CUSTOMER')">
                    <a th:href="@{/contact}">Contact</a>
                </li>
            </ul>
        </div>

        <!-- Thanh tìm kiếm với autocomplete -->
        <div class="nav-search" style="flex:1; display:flex; align-items:center; justify-content:center;">
            <form class="search-bar" method="get" autocomplete="off" style="position:relative; width:350px;">
                <input type="text" name="keyword" placeholder="Bạn cần tìm gì hôm nay?" style="width:100%; padding-right:40px;">
                <button type="submit" style="position:absolute; right:0; top:0; height:100%; border:none; background:#0074d9; color:white; border-radius:0 20px 20px 0; padding:0 16px;"><i class="fa fa-search"></i></button>
                <div class="autocomplete-suggestions" style="display:none; position:absolute; top:100%; left:0; right:0; background:#fff; border:1px solid #ccc; z-index:9999; max-height:250px; overflow-y:auto;"></div>
            </form>
        </div>

        <div class="nav-right">
            <!-- Cart and Avatar for Customer -->
            <div sec:authorize="hasRole('CUSTOMER')" class="user-actions">
                <a th:href="@{/cart}" class="cart-icon">
                    <span class="cart-badge">0</span>
                    <img src="/images/cart.png" alt="cart">
                </a>

                <div class="dropdown" id="avatarDropdown">
                    <a href="#" class="dropdown-toggle">
                        <img src="/images/default-avatar.svg" alt="Avatar" class="avatar">
                    </a>
                    <ul class="dropdown-menu" id="dropdownMenu">
                        <li>
                            <a th:href="@{/Customer/Wishlist}">
                                <span class="menu-icon"><img src="/images/wishlists.png" alt="wishlist"></span>
                                Wishlist
                            </a>
                        </li>
                        <li>
                            <a th:href="@{/customer/profile}">
                                <span class="menu-icon"><img src="/images/settings.png" alt="profile"></span>
                                Settings
                            </a>
                        </li>
                        <li>
                            <a th:href="@{/customer/notifications}">
                                <span class="menu-icon"><img src="/images/notification.png" alt="notification"></span>
                                Notifications
                            </a>
                        </li>
                        <li>
                            <a th:href="@{/customer/order-history}">
                                <span class="menu-icon"><img src="/images/order_history.png" alt="order_history"></span>
                                Order History
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li class="logout-item">
                            <form th:action="@{/auth/logout}" method="post" class="logout-form">
                                <button type="submit" class="logout-btn">
                                    <span class="menu-icon"><img src="/images/logout.png" alt="logout"></span>
                                    Logout
                                </button>
                            </form>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Avatar for Admin -->
            <div sec:authorize="hasRole('ADMIN')" class="user-actions">
                <div class="dropdown" id="adminAvatarDropdown">
                    <a href="#" class="dropdown-toggle">
                        <img src="/images/default-avatar.svg" alt="Avatar" class="avatar">
                    </a>
                    <ul class="dropdown-menu" id="adminDropdownMenu">
                        <li>
                            <a th:href="@{/staff/category}">
                                <span class="menu-icon"><img src="/images/staff.png" alt="category"></span>
                                Staff
                            </a>
                        </li>
                        <li>
                            <a th:href="@{admin/category}">
                                <span class="menu-icon"><img src="/images/administrator.png" alt="admin"></span>
                                Admin
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li class="logout-item">
                            <form th:action="@{/auth/logout}" method="post" class="logout-form">
                                <button type="submit" class="logout-btn">
                                    <span class="menu-icon"><img src="/images/logout.png" alt="logout"></span>
                                    Logout
                                </button>
                            </form>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Avatar for Staff -->
            <div sec:authorize="hasRole('STAFF')" class="user-actions">
                <div class="dropdown" id="staffAvatarDropdown">
                    <a href="#" class="dropdown-toggle">
                        <img src="/images/default-avatar.svg" alt="Avatar" class="avatar">
                    </a>
                    <ul class="dropdown-menu" id="staffDropdownMenu">
                        <li>
                            <a th:href="@{/staff/category}">
                                <span class="menu-icon"><img src="/images/staff.png" alt="staff"></span>
                                Staff
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li class="logout-item">
                            <form th:action="@{/auth/logout}" method="post" class="logout-form">
                                <button type="submit" class="logout-btn">
                                    <span class="menu-icon"><img src="/images/logout.png" alt="logout"></span>
                                    Logout
                                </button>
                            </form>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Login/Register for guest -->
            <div sec:authorize="!isAuthenticated()" class="auth-buttons">
                <a th:href="@{/auth/login}" class="btn-login">Login</a>
                <a th:href="@{/auth/register}" class="btn-register">Register</a>
            </div>

            <!-- Hamburger menu for mobile -->
            <button class="hamburger" id="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </nav>

    <!-- Mobile menu -->
    <div class="mobile-menu" id="mobileMenu">
        <ul>
            <li><a href="/">Introduct</a></li>
            <li><a th:href="@{/Product}">Product</a></li>
            <li><a th:href="@{/DiscountProducts}">Discount</a></li>
            <li sec:authorize="hasRole('CUSTOMER')">
                <a th:href="@{/order}">Order</a>
            </li>
            <li sec:authorize="hasRole('CUSTOMER')">
                <a th:href="@{/contact}">Contact</a>
            </li>
        </ul>

        <div sec:authorize="!isAuthenticated()" class="auth-buttons">
            <a th:href="@{/auth/login}" class="btn-login">Login</a>
            <a th:href="@{/auth/register}" class="btn-register">Register</a>
        </div>
    </div>


<script>
    // Enhanced dropdown functionality for all roles
    function setupDropdown(dropdownId, menuId) {
        const dropdown = document.getElementById(dropdownId);
        const dropdownMenu = document.getElementById(menuId);
        let dropdownTimeout;

        if (dropdown && dropdownMenu) {
            dropdown.addEventListener('mouseenter', () => {
                clearTimeout(dropdownTimeout);
                dropdownMenu.classList.add('active');
            });

            dropdown.addEventListener('mouseleave', () => {
                dropdownTimeout = setTimeout(() => {
                    if (!dropdownMenu.matches(':hover')) {
                        dropdownMenu.classList.remove('active');
                    }
                }, 300);
            });

            dropdownMenu.addEventListener('mouseenter', () => {
                clearTimeout(dropdownTimeout);
            });

            dropdownMenu.addEventListener('mouseleave', () => {
                dropdownTimeout = setTimeout(() => {
                    dropdownMenu.classList.remove('active');
                }, 200);
            });
        }
    }

    // Setup dropdowns for all roles
    setupDropdown('avatarDropdown', 'dropdownMenu'); // Customer
    setupDropdown('adminAvatarDropdown', 'adminDropdownMenu'); // Admin
    setupDropdown('staffAvatarDropdown', 'staffDropdownMenu'); // Staff

    // Mobile menu functionality
    const hamburger = document.getElementById('hamburger');
    const mobileMenu = document.getElementById('mobileMenu');
    const overlay = document.getElementById('overlay');

    hamburger.addEventListener('click', () => {
        mobileMenu.classList.toggle('active');
        overlay.classList.toggle('active');
        document.body.classList.toggle('no-scroll');
    });

    overlay.addEventListener('click', () => {
        mobileMenu.classList.remove('active');
        overlay.classList.remove('active');
        document.body.classList.remove('no-scroll');
    });

    // Close mobile menu when clicking on links
    mobileMenu.querySelectorAll('a').forEach(link => {
        link.addEventListener('click', () => {
            mobileMenu.classList.remove('active');
            overlay.classList.remove('active');
            document.body.classList.remove('no-scroll');
        });
    });

    // Make navigation sticky on scroll
    window.addEventListener('scroll', () => {
        const nav = document.querySelector('.horizontal-sidebar');
        if (window.scrollY > 50) {
            nav.style.boxShadow = '0 4px 12px rgba(0,0,0,0.1)';
            nav.style.padding = '8px 20px';
        } else {
            nav.style.boxShadow = '0 8px 24px rgba(0,0,0,0.1)';
            nav.style.padding = '10px 20px';
        }
    });
</script>
<script src="/js/autocomplete.js"></script>
</body>
</html>