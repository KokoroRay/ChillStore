<div th:fragment="content(voucherDto, selectedCategories, selectedBrands, errorMessage)">
    <div id="voucherFormContainer"
         th:attr="data-discount-pct=${voucherDto != null and voucherDto.discount_pct != null} ? ${voucherDto.discount_pct} : null,
                data-discount-amount=${voucherDto != null and voucherDto.discount_amount != null} ? ${voucherDto.discount_amount} : null">
        <div class="form-container">
            <h2 class="mb-4 text-center"
                th:text="${voucherDto != null and voucherDto.voucher_id != null} ? 'Edit Voucher' : 'Create New Voucher'">
                Voucher Form
            </h2>
            <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>

            <form th:action="${voucherDto != null and voucherDto.voucher_id != null}
                         ? @{/admin/vouchers/edit/{id}(id=${voucherDto.voucher_id})}
                         : @{/admin/vouchers/add}"
                  th:object="${voucherDto}" method="post" novalidate id="voucherFormElement">
                <input type="hidden" th:field="*{voucher_id}"
                       th:if="${voucherDto != null and voucherDto.voucher_id != null}"/>

                <div class="form-section">
                    <div class="form-section-title">
                        <i class="fas fa-info-circle"></i> Voucher Information
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="code" class="form-label">Code <span class="text-danger">*</span></label>
                            <input type="text" th:field="*{code}" class="form-control" id="code"
                                   placeholder="Enter voucher code" required/>
                            <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('code')}"
                                 th:errors="*{code}"></div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="quantity_available" class="form-label">Available Quantity <span
                                    class="text-danger">*</span></label>
                            <input type="number" min="1" th:field="*{quantity_available}" class="form-control"
                                   id="quantity_available" placeholder="e.g., 100" required/>
                            <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('quantity_available')}"
                                 th:errors="*{quantity_available}"></div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="description" class="form-label">Description</label>
                        <textarea th:field="*{description}" class="form-control" id="description" rows="2"
                                  placeholder="Detailed description of the voucher (optional)"></textarea>
                        <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('description')}"
                             th:errors="*{description}"></div>
                    </div>
                    <div class="mb-3">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" th:field="*{isSpecial}" id="isSpecial"
                                   role="switch"/>
                            <label class="form-check-label" for="isSpecial">
                                Special voucher (customer must enter code manually)
                            </label>
                        </div>
                        <small class="text-muted">
                            If selected, this voucher will not be automatically applied and the customer must enter the code to use it.
                        </small>
                    </div>

                </div>

                <div class="form-section">
                    <div class="form-section-title">
                        <i class="fas fa-percentage"></i> Promotion Details
                    </div>
                    <div class="row">
                        <div class="col-lg-6 mb-3">
                            <label class="form-label">Discount Type <span class="text-danger">*</span></label>
                            <div class="d-flex gap-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="discountType"
                                           id="discountPercent" value="percent"
                                           onclick="toggleDiscountType('percent')"
                                           th:checked="${voucherDto != null and voucherDto.discount_pct != null and voucherDto.discount_pct > 0}"/>
                                    <label class="form-check-label" for="discountPercent">Percentage</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="discountType"
                                           id="discountAmount" value="amount"
                                           onclick="toggleDiscountType('amount')"
                                           th:checked="${voucherDto != null and voucherDto.discount_amount != null and voucherDto.discount_amount > 0}"/>
                                    <label class="form-check-label" for="discountAmount">Fixed Amount</label>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6 mb-3">
                            <label for="min_order_amount" class="form-label">Minimum Order Value (₫)</label>
                            <div class="input-group">
                                <span class="input-group-text">₫</span>
                                <input type="number" step="1000" min="0" th:field="*{min_order_amount}"
                                       class="form-control" id="min_order_amount"
                                       placeholder="e.g., 500.000"/>
                            </div>
                            <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('min_order_amount')}"
                                 th:errors="*{min_order_amount}"></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-6 mb-3" id="discountPctField">
                            <label for="discount_pct" class="form-label">Discount Percentage (%)</label>
                            <div class="input-group">
                                <input type="number" step="0.01" min="0" max="100" th:field="*{discount_pct}"
                                       class="form-control" id="discount_pct" placeholder="e.g., 10"/>
                                <span class="input-group-text">%</span>
                            </div>
                            <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('discount_pct')}"
                                 th:errors="*{discount_pct}"></div>
                        </div>
                        <div class="col-lg-6 mb-3" id="discountAmountField">
                            <label for="discount_amount" class="form-label">Discount Amount (₫)</label>
                            <div class="input-group">
                                <span class="input-group-text">₫</span>
                                <input type="number" step="1000" min="0" th:field="*{discount_amount}"
                                       class="form-control" id="discount_amount" placeholder="e.g., 100.000"/>
                            </div>
                            <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('discount_amount')}"
                                 th:errors="*{discount_amount}"></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-6 mb-3">
                            <label for="start_date" class="form-label">Start Date <span
                                    class="text-danger">*</span></label>
                            <input type="date" th:field="*{start_date}" class="form-control" id="start_date"
                                   required/>
                            <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('start_date')}"
                                 th:errors="*{start_date}"></div>
                        </div>
                        <div class="col-lg-6 mb-3">
                            <label for="end_date" class="form-label">End Date <span
                                    class="text-danger">*</span></label>
                            <input type="date" th:field="*{end_date}" class="form-control" id="end_date" required/>
                            <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('end_date')}"
                                 th:errors="*{end_date}"></div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" th:field="*{active}" id="active"
                                   role="switch"/>
                            <label class="form-check-label" for="active">Activate voucher immediately</label>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="form-section-title">
                        <i class="fas fa-box-open"></i> Applicable Products
                    </div>
                    <p class="text-muted mb-4">
                        Select the category and brand this voucher will apply to. Leave both blank to apply to all products.
                    </p>
                    <div class="row">
                        <div class="col-md-6 mb-4">
                            <div class="card h-100">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <span>Categories</span>
                                    <i id="clearCategories" class="fas fa-times-circle clear-all-btn"
                                       title="Clear all"></i>
                                </div>
                                <div class="card-body">
                                    <select id="categoryIds" name="categoryIds" multiple="multiple"
                                            class="form-control"
                                            th:classappend="${#fields.hasErrors('categoryIds')}? 'is-invalid' : ''">
                                        <option th:each="cat : ${selectedCategories}
                                                th:value="${cat.id}"
                                        th:text="${cat.name}"
                                        selected="selected"></option>
                                    </select>
                                    <div class="invalid-feedback d-block"
                                         th:if="${#fields.hasErrors('categoryIds')}"
                                         th:errors="*{categoryIds}"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-4">
                            <div class="card h-100">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <span>Brands</span>
                                    <i id="clearBrands" class="fas fa-times-circle clear-all-btn"
                                       title="Clear all"></i>
                                </div>
                                <div class="card-body">
                                    <select id="brandIds" name="brandIds" multiple="multiple"
                                            class="form-control"
                                            th:classappend="${#fields.hasErrors('brandIds')}? 'is-invalid' : ''">
                                        <option th:each="br : ${selectedBrands}"
                                                th:value="${br.id}"
                                                th:text="${br.name}"
                                                selected="selected"></option>
                                    </select>
                                    <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('brandIds')}"
                                         th:errors="*{brandIds}"></div>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="isSpecial" th:field="*{isSpecial}">
                            <label class="form-check-label" for="isSpecial">Special Voucher (Customer must enter
                                code manually)</label>
                        </div>
                    </div>
                </div>

                <div class="form-actions mt-4 d-flex justify-content-end gap-2">
                    <a th:href="@{/admin/vouchers}" class="btn btn-secondary">
                        <i class="fas fa-times me-2"></i> Cancel
                    </a>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save me-2"></i>
                        <span th:text="${voucherDto != null and voucherDto.voucher_id != null} ? 'Update Voucher' : 'Create Voucher'">
              Save
            </span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>